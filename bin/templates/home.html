<div ng-controller="LedController">
	<div style="padding-top:0px">
		<div class="row">
			<div class="col-md-8">
				<img src="bin/templates/video-icon.png" id="uploaded-image" class="img-responsive img-rounded" alt="Video would be shown here">
			</div>
 			<div class="col-md-4">
				<div class="row" id="live-video">
					<div class="col-md-4">
						<label for="but1">Start</label>
						<button class="btn btn-primary" ng-click="liveVideo(true)" id="but1">Start Live Video</button>
					</div>
				</div>
				<div class="row" id="stop-video" style="display:none">
					<div class="col-md-4">
						<label for="but2">Stop</label>
						<button class="btn btn-primary" ng-click="liveVideo(false)" id="but2">Stop Live Video</button>
					</div>
				</div>
				<br>
				<div class="row" id="startvc">
					<div class="col-md-4">
						<label for="but3">Time Lapse</label>
						<button class="btn btn-primary" ng-click="captureVideo(true)" id="but3">Start Lapse</button>
					</div>
					
					<div class="col-md-4">
						<label for="text1">Interval</label>
						<input type="number" class="form-control" id="text1" ng-model="interval" placeholder="minutes" min="0.05" step="0.05">
					</div>
					<div class="col-md-4">
						<label for="text2">Repeat</label>
						<input type="number" class="form-control" id="text2" ng-model="repeat" placeholder="number" min="2" step="1">
					</div>

				</div>
				<div class="row" id="stopvc" style="display:none">
					<!-- <div class="col-md-4">
						<label for="but4" id="lab1">Stop Lapse</label>
						<button class="btn btn-primary" ng-click="captureVideo(false)" id="but4">Stop Lapse</button>
					</div> -->
					<div class="col-md-12">
						<label></label>
						<h4 id="lapse-info">Remaining images: {{repeat}} |  Time: {{interval * repeat}} minutes</h4>
					</div>
				</div>
				<br>
				<div class="row">
					<div class="col-md-4">
						<label for="but5">Capture</label>
						<button class="btn btn-primary" ng-click="captureImage()" id="but5">Capture Image</button>
					</div>
				</div>
				<br>
				<div class="row">
					<div class="col-md-12">
						<label for="">LED Control</label>
					</div>
				</div>
				<div class="row">
					<div class="col-md-2">
						<label for=""></label>
						<button onClick="led('0S')" class="btn btn-primary">Off</button>
					</div>
					<div class="col-md-9">
						<label for=""></label>
						<input id="slider" type="range" min="0" max="255" value="102" onChange="slider(this.value)" step ="5"/>
					</div>
					<div class="col-md-1">
						<label for=""></label>
						<button onClick="slider(document.getElementById('slider').value)" class="btn btn-primary">On</button>
					</div>
				</div>
				<br>
				<div class="row">
                                        <div class="col-md-12">
                                                <label for="">Magnification</label>
                                        </div>
                                </div>
				<div class="row">
					<div class="col-md-2">
                                                <button onClick="motor('0M')" class="btn btn-primary">4X</button>
                                        </div>
					<div class="col-md-2">
                                                <button onClick="motor('1M')" class="btn btn-primary">10X</button>
                                        </div>
					<div class="col-md-2">
                                                <button onClick="motor('2M')" class="btn btn-primary">20X</button>
                                        </div>
					<div class="col-md-2">
                                                <button onClick="motor('3M')" class="btn btn-primary">40X</button>
                                        </div>
					<div class="col-md-2">
                                                <button onClick="motor('4M')" class="btn btn-primary">100X</button>
                                        </div>
				</div>
				<br>
                                <div class="row">
                                        <div class="col-md-6">
						<div class="row">
							<div class="col-md-12">
                                                		<label for="">Imaging Mode</label>
							</div>
						</div>
						<div class="row">
                                        		<div class="col-md-3">
                                                		<button onClick="imaging('3A')" class="btn btn-primary">BF</button>
                                       			</div>
                                        		<div class="col-md-3">
                                                		<button onClick="imaging('4A')" class="btn btn-primary">OB</button>
                                        		</div>
                                        		<div class="col-md-3">
                                                		<button onClick="imaging('6A')" class="btn btn-primary">DF</button>
                                        		</div>
                                		</div>
                                        </div>
					<div class="col-md-6">
                                                <div class="row">
                                                        <div class="col-md-12">
                                                                <label for="">Focus</label>
                                                        </div>
                                                </div>
						<div class="row" id="focus-coarse">
                                                        <div class="col-md-4">
                                                                <button class="btn btn-default" onmousedown="focusMove('1Q')" onmouseup="focusStop('W')"><</button>
                                                        </div>
                                                        <div class="col-md-4">
                                                                <div ng-click="changeFocus()">{{focusMode}}</div>
                                                        </div>
                                                        <div class="col-md-4">
                                                                <button class="btn btn-default" onmousedown="focusMove('2Q')" onmouseup="focusStop('W')">></button>
                                                        </div>
                                                </div>
						<div class="row" id="focus-fine" style="display:none">
                                                        <div class="col-md-4">
                                                                <button class="btn btn-default" onmousedown="focusMove('3Q')" onmouseup="focusStop('W')"><</button>
                                                        </div>
                                                        <div class="col-md-4">
                                                                <div ng-click="changeFocus()">{{focusMode}}</div>
                                                        </div>
                                                        <div class="col-md-4">
                                                                <button class="btn btn-default" onmousedown="focusMove('4Q')" onmouseup="focusStop('W')">></button>
                                                        </div>
                                                </div>
                                        </div>
                                </div>
				
				
				<br>
				<div class="row">
					<div class="col-md-12">
						<label for="">Download</label>
					</div>
				</div>
				<div class="row">
					<div class="col-md-6">
						<button class="btn btn-success btn-block" id="download-images" ng-click="downloadImages()">Captured Images</button>
					</div>
					<div class="col-md-6">
                                                <button class="btn btn-success btn-block" id="download-timelapse"  ng-click="downloadTimeLapse()">Time Lapse</button>
                                        </div>
				</div>
			</div>
			
		</div>
	</div>
	<script>
			var socket = io.connect();
			var prev_turret = 1;
			var current_turret = 1;

			var displayImage = function(data){
				var URL = 'data:image/jpg;base64,'+data.buffer;
				document.querySelector('#uploaded-image').src = URL;
			};

			var slider = function(val){
				socket.emit('slider-value', {value : val});
				console.log("The value of interval is "+val);
			};

			var led = function(val){
				socket.emit('led', { value : val});
			};

			var motor = function(val){
				var slider_value = parseInt(document.getElementById('slider').value);
				current_turret = parseInt(val);
				var temp = current_turret - prev_turret;
				slider_value = slider_value + (temp*10/100*slider_value);
				document.getElementById('slider').value = slider_value;
				prev_turret = current_turret;
				slider(slider_value);
				socket.emit('motor', {value : val});
			};

			var imaging = function(val){
				socket.emit('imaging', {value : val});	
			};

			var focusMove = function(val){
				socket.emit('focus-move', {value : val});
			}

			var focusStop = function(val){
				socket.emit('focus-stop', {value : val});
			}

			socket.on('welcome', function(data){
				socket.emit('ping server', {hi : 'server'});
			});

			socket.on('pong server', function(data){
				console.log('Got a response back from server: '+data.temp);
			});

			socket.on('image upload', function(data){
				displayImage(data);
			});

			socket.on('timelapse', function(data){
				console.log("data of lapse "+data.temp)
				if(data.temp == "over"){
					document.getElementById('stopvc').style.display = "none";
					document.getElementById('startvc').style.display = "";
					document.getElementById('but3').disabled = true;
					document.getElementById('text1').disabled = true;
					document.getElementById('text2').disabled = true;
					document.getElementById('stop-video').style.display = "none";
					document.getElementById('live-video').style.display = "";
					document.getElementById('but1').disabled = false;
				}
				else{
					var rem_images = data.temp;
					var interval = document.getElementById('text1').value;
					var rem_time = rem_images * interval;
					document.getElementById('lapse-info').innerHTML = "Remaining images: "+rem_images+" | Time: "+rem_time+" minutes";
					//initial();
				}
			});

			socket.on('led data', function(data){
				blueval = data.value;
				console.log(data.value);
			});

			socket.on('sending image', function(data){
				console.log(data.buff);
				
			});

			socket.on('disconnect', function(data){
				console.log('Client got disconnected');
			});

			socket.on('disconnected', function(data){
				console.log('Client got disconnected');
			});
		</script>
</div>
